

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>butterfree.core.transform.aggregated_feature_set module &mdash; Butterfree 0.10.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="butterfree.core.transform.feature_set module" href="butterfree.core.transform.feature_set.html" />
    <link rel="prev" title="butterfree.core.transform.utils.window_spec module" href="butterfree.core.transform.utils.window_spec.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Butterfree
          

          
          </a>

          
            
            
              <div class="version">
                0.10.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="home.html">Welcome to the Butterfree Docs!</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="extract.html">Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform.html">Feature Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform.html#aggregated-feature-sets">Aggregated Feature Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="load.html">Sink</a></li>
<li class="toctree-l1"><a class="reference internal" href="stream.html">Streaming Feature Sets in Butterfree</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API Specification</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="butterfree.html">butterfree package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="butterfree.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="butterfree.core.html">butterfree.core package</a></li>
<li class="toctree-l4"><a class="reference internal" href="butterfree.testing.html">butterfree.testing package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="butterfree.html#module-butterfree">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Butterfree</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="modules.html">API Specification</a> &raquo;</li>
        
          <li><a href="butterfree.html">butterfree package</a> &raquo;</li>
        
          <li><a href="butterfree.core.html">butterfree.core package</a> &raquo;</li>
        
          <li><a href="butterfree.core.transform.html">butterfree.core.transform package</a> &raquo;</li>
        
      <li>butterfree.core.transform.aggregated_feature_set module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/butterfree.core.transform.aggregated_feature_set.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-butterfree.core.transform.aggregated_feature_set">
<span id="butterfree-core-transform-aggregated-feature-set-module"></span><h1>butterfree.core.transform.aggregated_feature_set module<a class="headerlink" href="#module-butterfree.core.transform.aggregated_feature_set" title="Permalink to this headline">¶</a></h1>
<p>AggregatedFeatureSet entity.</p>
<dl class="py class">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet">
<em class="property">class </em><code class="sig-prename descclassname">butterfree.core.transform.aggregated_feature_set.</code><code class="sig-name descname">AggregatedFeatureSet</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">entity</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">description</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">keys</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="butterfree.core.transform.features.key_feature.html#butterfree.core.transform.features.key_feature.KeyFeature" title="butterfree.core.transform.features.key_feature.KeyFeature">butterfree.core.transform.features.key_feature.KeyFeature</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">timestamp</span><span class="p">:</span> <span class="n"><a class="reference internal" href="butterfree.core.transform.features.timestamp_feature.html#butterfree.core.transform.features.timestamp_feature.TimestampFeature" title="butterfree.core.transform.features.timestamp_feature.TimestampFeature">butterfree.core.transform.features.timestamp_feature.TimestampFeature</a></span></em>, <em class="sig-param"><span class="n">features</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="butterfree.core.transform.features.feature.html#butterfree.core.transform.features.feature.Feature" title="butterfree.core.transform.features.feature.Feature">butterfree.core.transform.features.feature.Feature</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="butterfree.core.transform.feature_set.html#butterfree.core.transform.feature_set.FeatureSet" title="butterfree.core.transform.feature_set.FeatureSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">butterfree.core.transform.feature_set.FeatureSet</span></code></a></p>
<p>Holds metadata about the aggregated feature set.</p>
<p>This class overrides some methods of the parent FeatureSet class and has specific
methods for aggregations.</p>
<p>The AggregatedTransform can only be used on AggregatedFeatureSets. The construct
method will be responsible by collecting every feature’s transformation definitions
so it can run a groupby over the input dataframe, taking into account whether the
user want’s to run an rolling window aggregation, pivoting or just apply aggregation
functions.</p>
<p class="rubric">Example</p>
<p>This an example regarding the aggregated feature set definition. All features
and its transformations are defined.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.transform.aggregated_feature_set</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>      <span class="n">AggregatedFeatureSet</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.transform.features</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">Feature</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">KeyFeature</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">TimestampFeature</span><span class="p">,</span>
<span class="go">...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.transform.transformations</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">AggregatedTransform</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.constants.data_type</span> <span class="kn">import</span> <span class="n">DataType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.clients</span> <span class="kn">import</span> <span class="n">SparkClient</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">butterfree.core.transform.utils.function</span> <span class="kn">import</span> <span class="n">Function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">SparkClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.session.timeZone&quot;</span><span class="p">,</span> <span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;2020-01-01 13:01:00+000&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;publicado&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;2020-01-01 14:01:00+000&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&quot;publicado&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;2020-01-02 13:01:00+000&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&quot;alugado&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;2020-01-03 13:01:00+000&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;despublicado&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;2020-01-09 14:01:00+000&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;despublicado&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="s2">&quot;rent&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span> <span class="o">=</span> <span class="n">AggregatedFeatureSet</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;aggregated_feature_set&quot;</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">entity</span><span class="o">=</span><span class="s2">&quot;entity&quot;</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">description</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">features</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>       <span class="n">Feature</span><span class="p">(</span>
<span class="gp">... </span>           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature1&quot;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">description</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">transformation</span><span class="o">=</span><span class="n">AggregatedTransform</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">functions</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>                   <span class="n">Function</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="n">Function</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">stddev_pop</span><span class="p">,</span> <span class="n">DataType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)],</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>            <span class="n">from_column</span><span class="o">=</span><span class="s2">&quot;rent&quot;</span><span class="p">,</span>
<span class="gp">... </span>       <span class="p">),</span>
<span class="gp">... </span>   <span class="p">],</span>
<span class="gp">... </span>   <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">KeyFeature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;lul&quot;</span><span class="p">)],</span>
<span class="gp">... </span>   <span class="n">timestamp</span><span class="o">=</span><span class="n">TimestampFeature</span><span class="p">(</span><span class="n">from_column</span><span class="o">=</span><span class="s2">&quot;ts&quot;</span><span class="p">),</span>
<span class="go">...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">feature_set</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataframe</span><span class="o">=</span><span class="n">dataframe</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2020-01-15&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------------------+-------------+----------------+</span>
<span class="go">| id|          timestamp|feature1__avg|feature1__stddev|</span>
<span class="go">+---+-------------------+-------------+----------------+</span>
<span class="go">|  1|2020-01-01 13:01:00|       1000.0|            null|</span>
<span class="go">|  1|2020-01-03 13:01:00|       1000.0|            null|</span>
<span class="go">|  1|2020-01-02 13:01:00|       2000.0|            null|</span>
<span class="go">|  2|2020-01-09 14:01:00|       1000.0|            null|</span>
<span class="go">|  2|2020-01-01 14:01:00|       2000.0|            null|</span>
<span class="go">+---+-------------------+-------------+----------------+</span>
</pre></div>
</div>
<p>Since you didn’t define a window, the AggregateFeatureSet will always group by
keys and timestamp feature columns. So in this example, there will be no changes to
the dataframe, since it doesn’t duplicate on id and timestamp :)</p>
<p>Let’s run one example with windows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span><span class="o">.</span><span class="n">with_windows</span><span class="p">(</span><span class="n">definitions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;3 days&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">feature_set</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataframe</span><span class="o">=</span><span class="n">dataframe</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2020-01-15&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------------------+-----------------------------------------+</span>
<span class="go">| id|          timestamp|feature1__avg_over_3_days_rolling_windows|</span>
<span class="go">+---+-------------------+-----------------------------------------+</span>
<span class="go">|  1|2020-01-01 00:00:00|                                     null|</span>
<span class="go">|  2|2020-01-01 00:00:00|                                     null|</span>
<span class="go">|  1|2020-01-02 00:00:00|                                   1000.0|</span>
<span class="go">|  2|2020-01-02 00:00:00|                                   2000.0|</span>
<span class="go">|  1|2020-01-03 00:00:00|                                   1500.0|</span>
<span class="go">|  1|2020-01-04 00:00:00|                       1333.3333333333333|</span>
<span class="go">|  1|2020-01-05 00:00:00|                                   1500.0|</span>
<span class="go">|  2|2020-01-05 00:00:00|                                     null|</span>
<span class="go">|  1|2020-01-06 00:00:00|                                   1000.0|</span>
<span class="go">|  1|2020-01-07 00:00:00|                                     null|</span>
<span class="go">|  2|2020-01-10 00:00:00|                                   1000.0|</span>
<span class="go">|  2|2020-01-13 00:00:00|                                     null|</span>
<span class="go">+---+-------------------+-----------------------------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 29%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>timestamp</p></td>
<td><p>feature1__stddev_over_3_days_rolling_windows</p></td>
</tr>
<tr class="row-even"><td><p>1
2
1
2
1
1
1
2
1
1
2
2</p></td>
<td><p>2020-01-01 00:00:00
2020-01-01 00:00:00
2020-01-02 00:00:00
2020-01-02 00:00:00
2020-01-03 00:00:00
2020-01-04 00:00:00
2020-01-05 00:00:00
2020-01-05 00:00:00
2020-01-06 00:00:00
2020-01-07 00:00:00
2020-01-10 00:00:00
2020-01-13 00:00:00</p></td>
<td><blockquote>
<div><p>null
null
null
null</p>
</div></blockquote>
<p>707.1067811865476
577.3502691896258
707.1067811865476</p>
<blockquote>
<div><p>null
null
null
null
null</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p>(Had to break down the table result.)</p>
<p>And with pivot:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span><span class="o">.</span><span class="n">with_pivot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;publicado&quot;</span><span class="p">,</span> <span class="s2">&quot;despublicado&quot;</span><span class="p">])</span>
<span class="go">+---+-------------------+-----------------------+--------------------------+</span>
<span class="go">| id|          timestamp|publicado_feature1__avg|publicado_feature1__stddev|</span>
<span class="go">+---+-------------------+-----------------------+--------------------------+</span>
<span class="go">|  1|2020-01-01 13:01:00|                 1000.0|                      null|</span>
<span class="go">|  2|2020-01-01 14:01:00|                 2000.0|                      null|</span>
<span class="go">|  1|2020-01-02 13:01:00|                   null|                      null|</span>
<span class="go">|  1|2020-01-03 13:01:00|                   null|                      null|</span>
<span class="go">|  2|2020-01-09 14:01:00|                   null|                      null|</span>
<span class="go">+---+-------------------+-----------------------+--------------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 38%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>timestamp</p></td>
<td><p>despublicado_feature1__avg</p></td>
<td><p>despublicado_feature1__stddev</p></td>
</tr>
<tr class="row-even"><td><p>1
2
1
1
2</p></td>
<td><p>2020-01-01 13:01:00
2020-01-01 14:01:00
2020-01-02 13:01:00
2020-01-03 13:01:00
2020-01-09 14:01:00</p></td>
<td><blockquote>
<div><p>null
null
null</p>
</div></blockquote>
<p>1000.0
1000.0</p>
</td>
<td><p>null
null
null
null
null</p></td>
</tr>
</tbody>
</table>
<p>As you can see, we need to pass the values you want to pivot. It optimizes this
processing in spark and allows ignoring values when pivoting. If you wanted to get
the pivot aggregation for “alugado” too, just use:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span><span class="o">.</span><span class="n">with_pivot</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;publicado&quot;</span><span class="p">,</span> <span class="s2">&quot;despublicado&quot;</span><span class="p">,</span> <span class="s2">&quot;alugado&quot;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>You can also run it with pivot AND windows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span><span class="o">.</span><span class="n">with_pivot</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;publicado&quot;</span><span class="p">,</span> <span class="s2">&quot;despublicado&quot;</span><span class="p">,</span> <span class="s2">&quot;alugado&quot;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">with_windows</span><span class="p">(</span><span class="n">definitions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1 day&quot;</span><span class="p">,</span> <span class="s2">&quot;2 weeks&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The construct method will execute the feature set, computing all the
defined aggregated transformations at once.</p>
<p>Remember: when using an AggregatedFeatureSet without window, the group will use the
timestamp column.</p>
<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.construct">
<code class="sig-name descname">construct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dataframe</span><span class="p">:</span> <span class="n">pyspark.sql.dataframe.DataFrame</span></em>, <em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n"><a class="reference internal" href="butterfree.core.clients.spark_client.html#butterfree.core.clients.spark_client.SparkClient" title="butterfree.core.clients.spark_client.SparkClient">butterfree.core.clients.spark_client.SparkClient</a></span></em>, <em class="sig-param"><span class="n">end_date</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_processors</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; pyspark.sql.dataframe.DataFrame<a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.construct" title="Permalink to this definition">¶</a></dt>
<dd><p>Use all the features to build the feature set dataframe.</p>
<p>After that, there’s the caching of the dataframe, however since cache()
in Spark is lazy, an action is triggered in order to force persistence,
but we only cache if it is not a streaming spark dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataframe</strong> – input dataframe to be transformed by the features.</p></li>
<li><p><strong>client</strong> – client responsible for connecting to Spark session.</p></li>
<li><p><strong>end_date</strong> – user defined max date for having aggregated data (exclusive).</p></li>
<li><p><strong>num_processors</strong> – cluster total number of processors for repartitioning.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Spark dataframe with all the feature columns.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.features">
<em class="property">property </em><code class="sig-name descname">features</code><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.features" title="Permalink to this definition">¶</a></dt>
<dd><p>Features to compose the feature set.</p>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.features_columns">
<em class="property">property </em><code class="sig-name descname">features_columns</code><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.features_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the columns of all features in feature set.</p>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.get_schema">
<code class="sig-name descname">get_schema</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span>Dict<span class="p">]</span><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.get_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Get feature set schema.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>List of dicts with the feature set schema.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_distinct">
<code class="sig-name descname">with_distinct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">subset</span><span class="p">:</span> <span class="n">List</span></em>, <em class="sig-param"><span class="n">keep</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'last'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_distinct" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a distinct configuration for your aggregated feature set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subset</strong> – the columns where it will identify duplicates.</p></li>
<li><p><strong>keep</strong> – determines which duplicates to keep. Default ‘last’.
- first : Ascending sorting by timestamp.
- last : Descending sorting by timestamp.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An AggregatedFeatureSet configured with distinct.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_pivot">
<code class="sig-name descname">with_pivot</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">column</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">values</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_pivot" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a pivot configuration for your aggregated feature set.</p>
<p>This means we will group the input data, pivot over the column parameter and
run each aggregation function over the columns within each value group in
the values parameter. In spark it will be something like:
dataframe.groupBy(<a href="#id1"><span class="problematic" id="id2">*</span></a>group).pivot(column, values).agg(<a href="#id3"><span class="problematic" id="id4">*</span></a>aggregations)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>column</strong> – the column, containing categorical values, to pivot on.</p></li>
<li><p><strong>values</strong> – the distinct values you want to be pivoted.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An AggregatedFeatureSet configured with pivot.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_windows">
<code class="sig-name descname">with_windows</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">definitions</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#butterfree.core.transform.aggregated_feature_set.AggregatedFeatureSet.with_windows" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a list with windows defined.</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="butterfree.core.transform.feature_set.html" class="btn btn-neutral float-right" title="butterfree.core.transform.feature_set module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="butterfree.core.transform.utils.window_spec.html" class="btn btn-neutral float-left" title="butterfree.core.transform.utils.window_spec module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, QuintoAndar

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>